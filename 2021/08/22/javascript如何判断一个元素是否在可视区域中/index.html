<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wonderlust91.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.13.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前置概念client 相关   名称 概念 备注    clientWidth 可视区域宽度，包含 padding，但并不包含 border、scrollbar、margin 单位 px，只读，若元素大小超出可视区域，仅计算可视区域   clientHeight 可视区域高度，包含 padding，但并不包含 border、scrollbar、margin 单位 px，只读，若元素大小超出可视区域">
<meta property="og:type" content="article">
<meta property="og:title" content="javascript如何判断一个元素是否在可视区域中">
<meta property="og:url" content="http://wonderlust91.github.io/2021/08/22/javascript%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%9C%A8%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E4%B8%AD/index.html">
<meta property="og:site_name" content="WONDER&#39;s Notes">
<meta property="og:description" content="前置概念client 相关   名称 概念 备注    clientWidth 可视区域宽度，包含 padding，但并不包含 border、scrollbar、margin 单位 px，只读，若元素大小超出可视区域，仅计算可视区域   clientHeight 可视区域高度，包含 padding，但并不包含 border、scrollbar、margin 单位 px，只读，若元素大小超出可视区域">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-22T15:24:15.000Z">
<meta property="article:modified_time" content="2022-11-17T16:51:31.820Z">
<meta property="article:author" content="WONDERlust91">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="可视区域">
<meta property="article:tag" content="offsetTop、scrollTop">
<meta property="article:tag" content="getBoundingClientRect">
<meta property="article:tag" content="intersection observer">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://wonderlust91.github.io/2021/08/22/javascript%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%9C%A8%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E4%B8%AD/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://wonderlust91.github.io/2021/08/22/javascript%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%9C%A8%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E4%B8%AD/","path":"2021/08/22/javascript如何判断一个元素是否在可视区域中/","title":"javascript如何判断一个元素是否在可视区域中"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>javascript如何判断一个元素是否在可视区域中 | WONDER's Notes</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WONDER's Notes</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">前置概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#client-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.1.</span> <span class="nav-text">client 相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#offset-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.2.</span> <span class="nav-text">offset 相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scroll-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.3.</span> <span class="nav-text">scroll 相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getBoundingClientRect"><span class="nav-number">1.4.</span> <span class="nav-text">getBoundingClientRect()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intersection-Observer-API"><span class="nav-number">1.5.</span> <span class="nav-text">Intersection Observer API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.5.1.</span> <span class="nav-text">使用示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E5%85%83%E7%B4%A0%E5%9C%A8%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E4%B8%AD"><span class="nav-number">2.</span> <span class="nav-text">判断元素在可视区域中</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E4%BD%BF%E7%94%A8-scrollTop-%E4%B8%8E-offsetTop"><span class="nav-number">2.1.</span> <span class="nav-text">方法一 使用 scrollTop 与 offsetTop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C-%E4%BD%BF%E7%94%A8-getBoundingClientRect"><span class="nav-number">2.2.</span> <span class="nav-text">方法二 使用 getBoundingClientRect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89-%E4%BD%BF%E7%94%A8-Intersection-Observer"><span class="nav-number">2.3.</span> <span class="nav-text">方法三 使用 Intersection Observer</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">WONDERlust91</p>
  <div class="site-description" itemprop="description">又是一个艳阳天</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">135</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">241</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wonderlust91.github.io/2021/08/22/javascript%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%9C%A8%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E4%B8%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="WONDERlust91">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WONDER's Notes">
      <meta itemprop="description" content="又是一个艳阳天">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="javascript如何判断一个元素是否在可视区域中 | WONDER's Notes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          javascript如何判断一个元素是否在可视区域中
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-22 15:24:15" itemprop="dateCreated datePublished" datetime="2021-08-22T15:24:15+00:00">2021-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-17 16:51:31" itemprop="dateModified" datetime="2022-11-17T16:51:31+00:00">2022-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/08/22/javascript%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%9C%A8%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E4%B8%AD/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/08/22/javascript如何判断一个元素是否在可视区域中/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前置概念"><a href="#前置概念" class="headerlink" title="前置概念"></a>前置概念</h2><h3 id="client-相关"><a href="#client-相关" class="headerlink" title="client 相关"></a>client 相关</h3><table>
<thead>
<tr>
<th>名称</th>
<th>概念</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>clientWidth</td>
<td><strong>可视区域</strong>宽度，包含 padding，但并不包含 border、scrollbar、margin</td>
<td>单位 px，只读，若元素大小超出可视区域，仅计算可视区域</td>
</tr>
<tr>
<td>clientHeight</td>
<td><strong>可视区域</strong>高度，包含 padding，但并不包含 border、scrollbar、margin</td>
<td>单位 px，只读，若元素大小超出可视区域，仅计算可视区域</td>
</tr>
<tr>
<td>clientTop</td>
<td>元素上边框宽度，不包含上部的 padding 与 margin</td>
<td>单位 px，只读，与 borderTopWidth 属性相同</td>
</tr>
<tr>
<td>clientLeft</td>
<td>元素左边框宽度，不包含左部的 padding 与 margin</td>
<td>单位 px，只读，与 borderLeftWidth 属性相同，如果该元素有滚动条且 direction 为 right-to-left，在 windows 平台非 IE 浏览器该属性返回值为左边框宽度+滚动条宽度，IE 返回值为 0，在 macOS 平台均返回左边框宽度</td>
</tr>
</tbody></table>
<span id="more"></span>

<h3 id="offset-相关"><a href="#offset-相关" class="headerlink" title="offset 相关"></a>offset 相关</h3><table>
<thead>
<tr>
<th>名称</th>
<th>概念</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>offsetWidth</td>
<td><strong>可视区域</strong>宽度，包含 padding、border、scrollbar，但不包含 margin</td>
<td>单位 px，只读，若元素大小超出可视区域，仅计算可视区域</td>
</tr>
<tr>
<td>offsetHeight</td>
<td><strong>可视区域</strong>高度，包含 padding、border、scrollbar，但不包含 margin</td>
<td>单位 px，只读，若元素大小超出可视区域，仅计算可视区域</td>
</tr>
<tr>
<td>offsetParent</td>
<td>返回最近的 position 不为 static 的祖先元素</td>
<td>只读，若元素的 display 为’none’，则该属性为 null，该属性是 offsetTop、offsetLeft 的计算依据</td>
</tr>
<tr>
<td>offsetTop</td>
<td>返回当前元素顶部相对父元素 offsetParent 顶部的距离，包含当前元素的 margin 及相对父元素的 padding、scrollbar、border</td>
<td>只读，即当前元素 border 以外（不含 border）相对父元素 offsetParent border 以内（含 border）的距离</td>
</tr>
<tr>
<td>offsetLeft</td>
<td>返回当前元素左侧相对父元素 offsetParent 左侧的距离，包含当前元素的 margin 及相对父元素的 padding、scrollbar、border</td>
<td>只读，即当前元素 border 以外（不含 border）相对父元素 offsetParent border 以内（含 border）的距离</td>
</tr>
</tbody></table>
<h3 id="scroll-相关"><a href="#scroll-相关" class="headerlink" title="scroll 相关"></a>scroll 相关</h3><table>
<thead>
<tr>
<th>名称</th>
<th>概念</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>scrollWidth</td>
<td>返回元素的全部宽度，包含 padding 但不包含 scrollbar、border、margin</td>
<td>单位 px，只读，该属性包含了元素超出可视区域的部分</td>
</tr>
<tr>
<td>scrollHeight</td>
<td>返回元素的全部高度，包含 padding 但不包含 scrollbar、border、margin</td>
<td>单位 px，只读，该属性包含了元素超出可视区域的部分</td>
</tr>
<tr>
<td>scrollTop</td>
<td>设置或返回元素在垂直方向的滚动像素数</td>
<td>如果设置值非法或元素不可滚动，该属性会被设置为 0，如果设置值超过最大值，则设置为最大值</td>
</tr>
<tr>
<td>scrollLeft</td>
<td>设置或返回元素在水平方向的滚动像素数</td>
<td>如果设置值非法或元素不可滚动，该属性会被设置为 0，如果设置值超过最大值，则设置为最大值</td>
</tr>
</tbody></table>
<h3 id="getBoundingClientRect"><a href="#getBoundingClientRect" class="headerlink" title="getBoundingClientRect()"></a>getBoundingClientRect()</h3><p>getBoundingClientRect 是元素上的一个方法，调用后返回元素的大小、相对视窗口的位置等信息。（每次滚动位置改变时，调用该方法的返回值都会变化）</p>
<p>返回的对象有 8 个属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>x</td>
<td>元素原点（左上角顶点）的 x 坐标（相对视窗口左边的距离）</td>
</tr>
<tr>
<td>y</td>
<td>元素原点（左上角顶点）的 y 坐标（相对视窗口顶部的距离）</td>
</tr>
<tr>
<td>width</td>
<td>元素的宽度，包含 padding、scrollbar、border</td>
</tr>
<tr>
<td>height</td>
<td>元素的高度，包含 padding、scrollbar、border</td>
</tr>
<tr>
<td>left</td>
<td>元素左边相对视窗口左边的距离，通常与 x 相同，若 width 是负值，则为 x + width 的值</td>
</tr>
<tr>
<td>top</td>
<td>元素顶部相对视窗口顶部的距离，通常与 y 相同，若 height 为负值，则为 y + height 的值</td>
</tr>
<tr>
<td>right</td>
<td>元素右边相对视窗口左边的距离，通常与 x + width 相同，若 width 为负值，则为 x 的值</td>
</tr>
<tr>
<td>bottom</td>
<td>元素底部相对视窗口顶部的距离，通常与 y + height 相同，若 height 为负值，则为 y 的值</td>
</tr>
</tbody></table>
<h3 id="Intersection-Observer-API"><a href="#Intersection-Observer-API" class="headerlink" title="Intersection Observer API"></a>Intersection Observer API</h3><p>Intersection Observer API 提供了一种异步检测目标元素与祖先元素或 viewport（视窗口）相交情况变化的方法。</p>
<p>过去，相交检测通常要用到事件监听，并且需要频繁调用<code>Element.getBoundingClientRect()</code>方法以获取相关元素边界信息。事件监听和调用<code>Element.getBoundingClientRect()</code>都是在主线程上运行，因此频繁触发、调用可能会造成性能问题。</p>
<p>假如一个无限滚动页面有很多动画，并使用了两个第三方库，这两个第三方库都有自己的相交检测程序，都运行在主线程中，当用户滚动页面时，这些相交检测程序就会在页面滚动回调函数里不停触发调用，造成性能问题，体验效果让人失望。</p>
<p>Intersection Observer API 会注册一个回调函数，每当被监视的元素进入或者退出另外一个元素时，或者两个元素的相交部分大小发生变化时，该回调方法会被触发执行。这样我们网站的主线程不需要再为了监听元素相交而辛苦劳作，浏览器会自行优化元素相交管理。</p>
<p>注意 Intersection observer API 无法提供重叠的像素个数或者具体哪个像素重叠，它的更常见的使用方式是——当两个元素相交比例在 N%左右时，触发回调，以执行某些逻辑。</p>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><p>Intersection Observer 允许配置一个回调函数，当以下情况发生时调用</p>
<ul>
<li><p>每当目标（target）元素与设备视窗或其他指定元素发生交集的时候执行。设备视窗或其他元素我们称为根元素。</p>
</li>
<li><p>Observer 第一次监听目标元素时执行。</p>
</li>
</ul>
<p>目标元素（target）与根元素（root）之间的交叉程度叫交叉比（intersection ratio）。这是目标（target）元素相对于根（root）的交集百分比表示，它的取值在 0.0 到 1.0 之间。</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 传递给IntersectionObserver()构造函数的配置对象，控制观察者的回调函数的被调用时环境</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 指定根元素，用于检查目标元素可见性。必需是目标元素的祖先元素。如果未指定或为null，默认为浏览器视窗（viewport）</span>
  root<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#container"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 根元素外边距，用于确定root与target发生交集时计算交集的区域范围，使用该属性可控制root元素每一条边的收缩或扩张。如果指定了root，rootMargin也可以使用百分比来取值。</span>
  rootMargin<span class="token operator">:</span> <span class="token string">"0px"</span><span class="token punctuation">,</span>
  <span class="token comment">// 触发的交叉比阈值，可以是单一的数字也可以是数字的数组，表示当target与root相交程度达到该值时回调会被执行。</span>
  <span class="token comment">// 若要探测target在root中可见性超过50%时触发回调，则指定该属性为0.5；</span>
  <span class="token comment">// 若要探测target在root中可见程度每多25%就触发一次回调，则指定该属性为[0, 0.25, 0.5, 0.75, 1]；</span>
  <span class="token comment">// 默认值为0，表示target有一个像素出现在root中，就会触发回调执行；</span>
  <span class="token comment">// 设置为1，表示target完全出现在root中的时候回调才会执行；</span>
  threshold<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>entries<span class="token punctuation">,</span> observer<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 每个entry都表示一个被观察的target元素的相交变化</span>
    <span class="token comment">// entry.boundingClientRect target元素的位置、大小信息</span>
    <span class="token comment">// entry.intersectionRatio target元素与root元素交叉比，实际计算的是entry.intersectionRect 面积 / boundingClinetRect 面积，元素非矩形时，也按矩形计算</span>
    <span class="token comment">// entry.intersectionRect 相交区域的位置、大小信息</span>
    <span class="token comment">// entry.isIntersecting target元素是否与root元素相交</span>
    <span class="token comment">// entry.rootBounds root元素的位置、大小信息</span>
    <span class="token comment">// entry.target target元素本身</span>
    <span class="token comment">// entry.time 从observer的时间原点到交叉触发的时间的时间戳</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 新建一个相交观察实例</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听target</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#element"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="判断元素在可视区域中"><a href="#判断元素在可视区域中" class="headerlink" title="判断元素在可视区域中"></a>判断元素在可视区域中</h2><h3 id="方法一-使用-scrollTop-与-offsetTop"><a href="#方法一-使用-scrollTop-与-offsetTop" class="headerlink" title="方法一 使用 scrollTop 与 offsetTop"></a>方法一 使用 scrollTop 与 offsetTop</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/**
 * 通过元素及其可滚动的父元素，判断当前元素是否在父元素可视区域内（仅判断了垂直滚动）
 * @param elementNode 当前元素
 * @param containerNode 带滚动条的包裹父元素
 */</span>
<span class="token keyword">function</span> <span class="token function">isElementViewableInContainer</span><span class="token punctuation">(</span>elementNode<span class="token operator">:</span> HTMLDivElement<span class="token punctuation">,</span> containerNode<span class="token operator">:</span> HTMLDivElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 子元素相对父元素顶部的距离</span>
  <span class="token keyword">const</span> elementTop <span class="token operator">=</span> elementNode<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>
  <span class="token comment">// 子元素底部相对父元素顶部的距离，使用offsetHeight将边框以内都算入子元素高度</span>
  <span class="token keyword">const</span> elementBottom <span class="token operator">=</span> elementNode<span class="token punctuation">.</span>offsetTop <span class="token operator">+</span> elementNode<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
  <span class="token comment">// 父元素滚动距离</span>
  <span class="token keyword">const</span> containerTop <span class="token operator">=</span> containerNode<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
  <span class="token comment">// 父元素当前可视底部距离，使用clientHeight，不包含父元素滚动条及边框高度</span>
  <span class="token keyword">const</span> containerBottom <span class="token operator">=</span> containerNode<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> container<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
  <span class="token comment">// 若子元素顶在父元素滚动后顶部之下 且 子元素底部在父元素滚动后底部之上，则判定为在滚动父元素的可视区域内</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elementTop <span class="token operator">>=</span> containerTop <span class="token operator">&amp;&amp;</span> elementBottom <span class="token operator">&lt;=</span> containerBottom<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">// 否则在可视区域外</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="方法二-使用-getBoundingClientRect"><a href="#方法二-使用-getBoundingClientRect" class="headerlink" title="方法二 使用 getBoundingClientRect"></a>方法二 使用 getBoundingClientRect</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/**
 * 通过元素及其可滚动的父元素，判断当前元素是否在父元素可视区域内（仅判断了垂直滚动）
 * @param elementNode 当前元素
 * @param containerNode 带滚动条的包裹父元素
 */</span>
<span class="token keyword">function</span> <span class="token function">isElementViewableInContainer</span><span class="token punctuation">(</span>elementNode<span class="token operator">:</span> HTMLDivElement<span class="token punctuation">,</span> containerNode<span class="token operator">:</span> HTMLDivElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 子元素rect</span>
  <span class="token keyword">const</span> elementRect <span class="token operator">=</span> elementNode<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 子元素顶部相对视窗口顶部的距离</span>
  <span class="token keyword">const</span> elementTop <span class="token operator">=</span> elementRect<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
  <span class="token comment">// 子元素底部相对视窗口顶部的距离</span>
  <span class="token keyword">const</span> elementBottom <span class="token operator">=</span> elementRect<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
  <span class="token comment">// 父元素rect</span>
  <span class="token keyword">const</span> containerRect <span class="token operator">=</span> containerNode<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 父元素顶部相对视窗口顶部的距离</span>
  <span class="token keyword">const</span> containerTop <span class="token operator">=</span> containerRect<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
  <span class="token comment">// 父元素底部相对视窗口顶部的距离</span>
  <span class="token keyword">const</span> containerBottom <span class="token operator">=</span> containerRect<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
  <span class="token comment">// 若子元素顶在父元素滚动后顶部之下 且 子元素底部在父元素滚动后底部之上，则判定为在滚动父元素的可视区域内</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elementTop <span class="token operator">>=</span> containerTop <span class="token operator">&amp;&amp;</span> elementBottom <span class="token operator">&lt;=</span> containerBottom<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">// 否则在可视区域外</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="方法三-使用-Intersection-Observer"><a href="#方法三-使用-Intersection-Observer" class="headerlink" title="方法三 使用 Intersection Observer"></a>方法三 使用 Intersection Observer</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 根元素</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 目标元素</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// observer配置</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  root<span class="token operator">:</span> root<span class="token punctuation">,</span>
  rootMargin<span class="token operator">:</span> <span class="token string">"0px"</span><span class="token punctuation">,</span>
  threshold<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 是否可见</span>
<span class="token keyword">let</span> isViewable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">// 回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>entries<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">===</span> root<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 完全可见时相交比率为1</span>
      isViewable <span class="token operator">=</span> entry<span class="token punctuation">.</span>intersectionRatio <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 新建观察者</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 监听目标元素</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>参考资料</p>
<p><a target="_blank" rel="noopener" href="https://github.com/febobo/web-interview/issues/84">面试官：如何判断一个元素是否在可视区域中？</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000017150136">如何判断元素是否在可视区域 ViewPort</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22675126/what-is-offsetheight-clientheight-scrollheight">What is offsetHeight, clientHeight, scrollHeight?</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/487073/how-to-check-if-element-is-visible-after-scrolling">How to check if element is visible after scrolling?</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API">MDN Intersection Observer API</a></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/javascript/" rel="tag"># javascript</a>
              <a href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F/" rel="tag"># 可视区域</a>
              <a href="/tags/offsetTop%E3%80%81scrollTop/" rel="tag"># offsetTop、scrollTop</a>
              <a href="/tags/getBoundingClientRect/" rel="tag"># getBoundingClientRect</a>
              <a href="/tags/intersection-observer/" rel="tag"># intersection observer</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/08/01/css%E6%96%B0%E6%A0%87%E5%87%86%E9%A2%9C%E8%89%B2%E8%AF%AD%E6%B3%95%E9%80%A0%E6%88%90%E7%9A%84%E9%94%99%E8%AF%AF/" rel="prev" title="css新标准颜色语法造成的错误">
                  <i class="fa fa-chevron-left"></i> css新标准颜色语法造成的错误
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/09/01/css%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%BB%BA%E8%AE%AEfont-size%E8%AE%BE%E7%BD%AE%E4%B8%BA12px%E4%BB%A5%E4%B8%8B/" rel="next" title="css为什么不建议font-size设置为12px以下">
                  css为什么不建议font-size设置为12px以下 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WONDERlust91</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"wonderlust91","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
